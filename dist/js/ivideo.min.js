/*! 版权所有，翻版必究 */!function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=9)}([function(t,e,i){"use strict";function n(){var t=window.navigator.userAgent;return{isIphone:/iPhone/i.test(t),isIpad:/iPad/i.test(t),isAndroid:/Android/i.test(t),isMac:!1,isWeixin:/MicroMessenger/i.test(t),isQQ:/QQ\//.test(t),isQQBrowser:/MQQBrowser/.test(t),isChrome:/Chrome/.test(t),isIE:!1,isFirefox:!1,isSafari:/Safari/.test(t)&&!/Chrome/.test(t),version:0,userAgent:t}}function o(){var t=new Date,e=s(t.getHours()),i=s(t.getMinutes()),n=s(t.getSeconds());return"".concat(e,":").concat(i,":").concat(n)}function r(t){var e=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if("--"===t)return t;var i=Math.floor(t/60),n=Math.floor(t%60),o=60<i?Math.floor(i/60):0;return t=s(i)+":"+s(n),(o||e)&&(t=s(o)+":"+t),t}function s(t){return t<10?"0"+t:t}function a(t){return"[object Function]"===Object.prototype.toString.call(t)}function c(t){return(1<arguments.length&&void 0!==arguments[1]?arguments[1]:document).querySelector(t)}function u(t){return document.createElement(t)}function d(t,e){if(!(2<arguments.length&&void 0!==arguments[2]&&arguments[2]))return Object.assign(t,e),t;for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];l(n)?(t[i]=l(t[i])?t[i]:{},d(t[i],n,!0)):h(n)?t[i]=n.concat([]):t[i]=n}return t}function l(t){return"[object Object]"===Object.prototype.toString.call(t)}function h(t){return Array.isArray(t)}i.d(e,"d",function(){return n}),i.d(e,"g",function(){return o}),i.d(e,"e",function(){return r}),i.d(e,"i",function(){return a}),i.d(e,"j",function(){return c}),i.d(e,"c",function(){return u}),i.d(e,"b",function(){return d}),i.d(e,"h",function(){return h}),i.d(e,"k",function(){return v}),i.d(e,"f",function(){return p}),i.d(e,"a",function(){return m});var f=0;function v(t,e){e=e||2e3,t.classList.remove("toast-hide"),clearTimeout(f),f=setTimeout(function(){t.classList.add("toast-hide")},e)}function p(t){(t=t||document.documentElement).requestFullscreen?t.requestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullScreen?t.webkitRequestFullScreen():t.msRequestFullscreen&&t.msRequestFullscreen()}function m(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}},function(t,e){t.exports=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}},function(t,e){function i(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}t.exports=function(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}},function(t,e,i){"use strict";(function(t){var n=i(4),o=i.n(n),r=i(1),s=i.n(r),a=i(2),c=i.n(a),u=i(0),d=(Object(u.d)(),"undefined"!=typeof window?window:t||void 0),l=d.console||{log:function(){},info:function(){},warn:function(){},error:function(){}},h={info:"log|info|warn|error|alert",warn:"warn|error|alert",error:"error|alert",alert:"alert"},f=function(){function t(){var e=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"out",n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];s()(this,t),this.debug=!0===n?"info":n,this.prefix=i,n&&!h[n]&&(this.debug="info"),h.info.split("|").forEach(function(t){var i=e;i[t]=function(){var e=Array.from(arguments);e.unshift(t),i.out.apply(i,o()(e))}})}return c()(t,[{key:"out",value:function(){if(this.debug){var t=Array.from(arguments),e=t.shift(),i=l[e]||d[e];h[this.debug].split("|").includes(e)&&(t.unshift(this.prefix+"::"+Object(u.g)()),"alert"===e&&(t=[t.join("---")]),i.apply(d,t))}}},{key:"instance",value:function(t){var e=this;(h.info.split("|")||[]).forEach(function(i){t[i]=e[i]})}}]),t}();e.a=f}).call(this,i(5))},function(t,e,i){var n=i(6),o=i(7),r=i(8);t.exports=function(t){return n(t)||o(t)||r()}},function(pb,qb){var rb;rb=function(){return this}();try{rb=rb||Function("return this")()||eval("this")}catch(t){"object"==typeof window&&(rb=window)}pb.exports=rb},function(t,e){t.exports=function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}},function(t,e){t.exports=function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}},function(t,e){t.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(t,e,i){"use strict";i.r(e);var n=i(3),o=(i(1),i(2),i(0)),r={mp4:"video/mp4",hls:"rtmp/hls",mpeg:"application/x-mpegURL"},s={LOADING:"loading",WAITING:"waiting",PAUSED:"paused",OFFLINE:"offline",TIMEOUT:"timeout",ERROR:"error",HIDEPRO:"hidepro"},a=Object(o.d)();function c(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.selector=t||".ivideo-js",this.evts={},this.opts=Object(o.b)({src:[],isLive:!1,controls:!0,hasProgress:!0,volume:1,allowFull:!0,poster:"",preload:"metadata",useCanvas:!1,useSelfControls:!1,inline:!0,autoplay:!1,loop:!1,timeout:30,width:"100%",height:220},e,!0),this.timecount=0,this.timeswitch=!0,this.status=s.LOADING,this.isPaused=!0,this.isFirstTouch=!0,this.touchMove=!1,this.touchPlay=!1,this.inited=!1,this._video=null,this._canvas={},this.init()}c.prototype.init=function(){this.log("video init..."),this.render()},c.prototype.render=function(){var t=this,e="string"==typeof this.selector?Object(o.j)(this.selector):this.selector;if(e){this.el=e,this.container=Object(o.j)(".ivideo",e)||Object(o.c)("div"),this.container.className="ivideo ivideo-loading",this.container.innerHTML="";var i=Object(o.c)("div");i.className="ivideo-components",i.innerHTML='\n        <div class="loading">\n            <p><i></i>加载中...</p>\n        </div>\n        <div class="offline">\n            <p>网络连接已断开，点击重试</p>\n        </div>\n        <div class="timeout">\n            <p>加载超时，点击重试</p>\n        </div>\n        \x3c!-- 播放与暂停大按钮 --\x3e\n        <div class="ivideo-btn"></div>\n        <span class="ivideo-volume toast-hide">音量 100%</span>\n        <h2 class="ivideo-title"></h2>',setTimeout(function(){t.container.appendChild(i),t.el.appendChild(t.container),t._offline=Object(o.j)(".offline",i),t._timeout=Object(o.j)(".timeout",i),t._playBig=Object(o.j)(".ivideo-btn",i),t._volume=Object(o.j)(".ivideo-volume",i),t._title=Object(o.j)(".ivideo-title",i),t.renderVideo(),t.setSize(),t.videoEvt(),t.inited=!0})}else this.error("元素不存在，请检测传入的el参数是否正确 el=".concat(e,", 支持元素，选择器"))},c.prototype.renderVideo=function(){var t=this,e=this.opts,i=Object(o.c)("video");if(i.className="ivideo-video",i.download=!1,i.crossorigin="anonymous",e.inline&&(i.setAttribute("webkit-playsinline",!0),i.setAttribute("playsinline",!0),i.setAttribute("x5-playsinline",!0),i.setAttribute("x5--video--player--type","h5"),i.setAttribute("x5-video-player-type","h5"),i.setAttribute("x-webkit-airplay","allow")),e.autoplay&&(i.autoplay=!0),e.loop&&(i.loop=!0),e.controls)if(e.useSelfControls)i.controls=!0;else{var n='\n                <div class="ivideo-play"></div>\n                <span class="ivideo-time">\n                    <time class="ivideo-cur">00:00</time> /\n                    <time class="ivideo-total">--:--</time>\n                </span>\n                {{progress}}';n=n.replace("{{progress}}",e.hasProgress?'<div class="ivideo-progress">\n                    <p class="ivideo-bar"></p>\n                    <p class="ivideo-buffered"></p>\n                </div>':""),e.allowFull&&(n+='<div class="ivideo-full"></div>');var r=Object(o.c)("div");r.className="ivideo-controller",r.innerHTML=e.controls?n:"",this.container.appendChild(r),setTimeout(function(){t._playBtn=Object(o.j)(".ivideo-play",r),t._cur=Object(o.j)(".ivideo-cur",r),t._duration=Object(o.j)(".ivideo-total",r),t._fullBtn=Object(o.j)(".ivideo-full",r),t._progress=Object(o.j)(".ivideo-progress",r),t._bar=Object(o.j)(".ivideo-bar",r),t._buffer=Object(o.j)(".ivideo-buffered",r)})}this._video=i,this.src(e.src),this.container.appendChild(this._video),this.execute("ready")},c.prototype.videoEvt=function(){var t=this,e=this._video,i=this.container,n=this;e.addEventListener("canplaythrough",function(){if(t.timeswitch=!1,i.classList.remove("ivideo-"+s.LOADING),i.classList.remove("ivideo-"+s.WAITING),e.paused&&i.classList.add("ivideo-"+s.PAUSED),t.isFirstTouch&&t.touchPlay&&a.isWeixin&&(t.play(),t.isFirstTouch=!1,t.touchPlay=!1),t._duration){var n=Object(o.e)(e.duration);t._duration.innerHTML=n}}),["playing","waiting","seeking","seeked"].forEach(function(t){e.addEventListener(t,function(e){switch(e.type){case"waiting":case"seeking":i.classList.add("ivideo-"+s.WAITING);break;case"playing":case"seeked":i.classList.remove("ivideo-"+s.WAITING)}n.execute(t)})}),["error"].forEach(function(t){e.addEventListener(t,function(e){n.error(e),n.execute(t)})}),e.addEventListener("ended",function(){this.execute("ended")}),e.addEventListener("play",function(){i.classList.remove("ivideo-"+s.PAUSED),i.classList.remove("ivideo-"+s.LOADING),i.classList.remove("ivideo-"+s.WAITING),t.execute("play")}),e.addEventListener("pause",function(){i.classList.add("ivideo-"+s.PAUSED),t.execute("pause")}),e.addEventListener("timeupdate",function(){if(navigator.onLine){if(t.opts.controls){t._cur||(t._cur=Object(o.j)(".ivideo-cur",i));var n=Object(o.e)(e.currentTime);if(t._cur.innerHTML=n,!e.duration||0===e.currentTime)return;var r=t.getWidthForTime(t._video.currentTime);t._bar.style.width=r+"px",t.setBuffer()}t.execute("timeupdate")}else t.setStatus(s.OFFLINE)});var r={fx:0,fy:0,x:0,y:0};i.addEventListener("touchstart",function(e){if(i.classList.contains("video-"+s.LOADING))e.preventDefault();else{t.touchPlay=!1,t.touchMove=!1,t.isPaused=t._video.paused;var n=e.changedTouches[0];r.x=n.pageX,r.y=n.pageY,r.fx=n.pageX,r.fy=n.pageY}}),i.addEventListener("touchmove",function(e){t.touchMove=!0,e.preventDefault();var i=e.changedTouches[0],n=i.pageX,o=i.pageY,s=Math.abs(o-r.fy)>Math.abs(n-r.fx),a=Math.abs(n-r.fx)>Math.abs(o-r.fy);if(s){var c=0<r.y-o?1:-1;t.setVolume(c)}else if(a){var u=n-r.x;t.setCurrentTime(u)}r.x=i.pageX,r.y=i.pageY}),i.addEventListener("touchend",function(n){var r=n.target,c=r.tagName.toLowerCase(),u=r.classList;i.classList.contains("ivideo-"+s.LOADING)||(u.contains("ivideo-btn")||u.contains("ivideo-play")?a.isWeixin&&t.isFirstTouch?(t.touchPlay=!0,t.reload()):e.paused?t.play():t.pause():t.touchMove||"video"!==c?t.opts.allowFull&&u.contains("ivideo-full")?i.classList.contains("full")?(Object(o.a)(),i.classList.remove("full")):(i.classList.add("full"),Object(o.f)(i)):!t.isPaused&&t.touchMove&&t._video.play():i.classList.contains("ivideo-hidepro")?i.classList.remove("ivideo-hidepro"):i.classList.add("ivideo-hidepro"))}),[this._offline,this._timeout].forEach(function(e){e.addEventListener("touchend",function(){t.reload()})})},c.prototype.setCurrentTime=function(t){this._video.pause();var e=this._bar.offsetWidth+t;e<0||e>this._progress.offsetWidth?this.log("超出播放范围"):(e=(e=e<0?0:e)>this._progress.offsetWidth?this._progress.offsetWidth:e,this._bar.style.width=e+"px",this._video.currentTime=e/this._progress.offsetWidth*this._video.duration,this._cur.innerHTML=Object(o.e)(this._video.currentTime))},c.prototype.setSize=function(t){var e=this.opts;t=t||{width:e.width,height:e.height},this._canvas.width=parseInt(t.width),this._canvas.height=parseInt(t.height),this.container.style.width="number"==typeof t.width?t.width+"px":t.width,this.container.style.height="number"==typeof t.height?t.height+"px":t.height},c.prototype.src=function(t){if(navigator.onLine)if(t="string"==typeof t?{src:t}:t,Object(o.h)(t)||(t=[t]),0!==t.length){if(!t[0].src)return this.log(t),void this.error("视频地址错误，请确认地址");this.opts.src=t;var e="";t.forEach(function(t){var i=r[t.type];e+='<source src="'.concat(t.src,'"'),e+=i?' type="'.concat(i,'" />'):"/>"});var i=t[0].src,n=t[0].title||i.slice(i.lastIndexOf("/")+1)||"";this._title.innerHTML=n,this._video.innerHTML=e,this.reload()}else this.warn("请传入src参数");else this.setStatus(s.OFFLINE)},c.prototype.reload=function(){this.timeswitch=!0,this.timer(),!a.isWeixin||this.inited?this.setStatus(s.LOADING):(this.container.classList.remove("ivideo-"+s.LOADING),this.container.classList.add("ivideo-"+s.PAUSED)),this._bar&&(this._bar.style.width=0),this._buffer&&(this._buffer.style.width=0),this._video.load()},c.prototype.play=function(){this._video.play()},c.prototype.pause=function(){this._video.pause()},c.prototype.stop=function(){this._video.load()},c.prototype.muted=function(t){this._video.muted=t},c.prototype.timer=function(){var t=this;if(this.timeswitch){if(this.timecount++,this.timecount===this.opts.timeout)return this.setStatus(s.TIMEOUT),this.timecount=0,void this.warn("加载超时");setTimeout(function(){t.timer()},1e3)}else this.timecount=0},c.prototype.setStatus=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";if(s[t.toUpperCase()]){var e=this.container;switch(t){case s.LOADING:e.classList.remove("ivideo-"+s.OFFLINE),e.classList.remove("ivideo-"+s.TIMEOUT);break;case s.OFFLINE:case s.TIMEOUT:this.timeswitch=!1,e.classList.remove("ivideo-"+s.LOADING),e.classList.remove("ivideo-"+s.WAITING)}var i="ivideo-"+t;e.classList.add(i)}else this.warn("不存在该状态，设置失败。setStatus:",t)},c.prototype.getWidthForTime=function(t){var e=this._progress.getBoundingClientRect();return t/this._video.duration*e.width},c.prototype.getTimeForWidth=function(t){return t/this._progress.getBoundingClientRect().width*this._video.duration},c.prototype.setVolume=function(t){var e=100*this._video.volume+t;e=Math.max(0,Math.min(100,e)),this._video.volume=e/100,this._volume.innerHTML="音量 "+Math.ceil(e)+"%",Object(o.k)(this._volume)},c.prototype.setBuffer=function(){if(4===this._video.readyState){var t=this._video.buffered.length,e=this.getWidthForTime(this._video.buffered.end(t-1));this._buffer.style.width=e+"px"}},c.prototype.on=function(t,e){if("string"!=typeof t||!Object(o.i)(e))return this.warn("事件类型请传入字符串, 事件函数必须为函数"),void this.warn("type =",t,"handler =",e);this.evts[t]||(this.evts[t]=[]),this.evts[t].push(e)},c.prototype.execute=function(t){if(this.evts[t]){var e={video:this._video,src:this.opts.src};this.evts[t].forEach(function(t){t(e)})}},c.use=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];Object(o.h)(t)||(t=[t]),t.forEach(function(t){t.instance(c.prototype)})};var u=c,d=(i(10),new n.a("iVideo",!0));u.use(d),("undefined"!=typeof window?window:void 0).iVideo=u},function(t,e){}]);